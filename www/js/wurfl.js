var selectedCapabilities={};var timeout=null;var dchart=null;var renderedChart=false;function showLoadingScreen(){$("loadB").show();$("loadF").show();timeout=setTimeout(plead,20000)}function hideLoadingScreen(){hideCapabilityEdit();$("loadB").hide();$("loadF").hide();$("loadMessage").innerHTML="";clearTimeout(timeout);closePlead()}function showCapabilityEdit(a){hideLoadingScreen();if(typeof a!="undefined"){$("group_name").innerHTML=a.group_name;$("capability_name").innerHTML=a.capability_name;$("base_type").innerHTML=a.capability_data_type;$("capabilityQueryDest").innerHTML="";$("capabilityQueryDest").appendChild(a.queryControl);$("capeOptIn").hide()}$("loadB").show();$("capabilityEdit").show()}function capeOpted(a){if(a.checked){$("capeOptIn").show()}else{$("capeOptIn").hide()}}function hideCapabilityEdit(){$("cape_apply_criteria").checked=false;$("loadB").hide();$("capabilityEdit").hide()}function clearCriteria(){if(renderedChart){var a=confirm("Do you want to clear the results and start a new search?");if(!a){return false}renderedChart=false;new Effect.Move("slab",{x:526});$("columnQuery").className="columnHalf";setTimeout(function(){dchart.destructor();$("chartGoesHere").innerHTML=""},1000)}$("criteriaColumns").innerHTML="";$("criteriaParams").innerHTML="";$("criteriaHolder").innerHTML="";$("criteriaWhere").hide();$("columnCapeSelect").show();return false}function loadMessage(a){$("loadMessage").innerHTML=a}function plead(){$("subMessage").style.display=""}function closePlead(){$("subMessage").style.display="none"}function selectBrand(g){var d=g.options[g.selectedIndex].value;var e=$("modelSelect").options.length-1;for(var f=e;f>=0;f--){$("modelSelect").options[f]=null}var l=new Array();for(var h in brands[d]["models"]){var a=brands[d]["models"][h].toLowerCase();l.push(a+"|||"+h)}l.sort();for(var f=0;g=l[f];f++){var k=g.split(/\|\|\|/);var h=k[1];var m=brands[d]["models"][h];var b=document.createElement("option");b.text=m;b.value=h;$("modelSelect").options.add(b)}}function selectBrandCapability(d){var a=d.options[d.selectedIndex].text;removeCapability(brandId);if(brandId>0){addCapability(brandId,a)}}function selectModelCapability(d){removeCapability(modelId);removeCapability(brandId);if(brandId>0){var a=$("brandSelect").options[$("brandSelect").selectedIndex].text;addCapability(brandId,a)}if(modelId>0){var a=d.options[d.selectedIndex].text;addCapability(modelId,a)}}function addCapabilityFromSearch(){var b=$("capabilitySearch").value;for(var a in capabilities){if(b==capabilities[a]){addCapability(a)}}}function addCapability(s,r){if(capabilitiesFull[s]!=undefined&&capabilitiesFull[s]!=null){var q=capabilitiesFull[s];var E=new Element("div",{"class":"capabilityCriteria",id:"capability-"+s});var y=q.name;var j=groups[q.group_id].name;var v=bigTree[q.group_id]["capabilities"][s]["description"];var i=bigTree[q.group_id]["capabilities"][s]["options"];$("capability_description").innerHTML=v;$("instructions").innerHTML=i;var d=new Element("input",{type:"hidden",name:"capability_id",value:s});E.appendChild(d);var n=capabilityDataTypes[q.capability_data_type_id];if(n=="boolean"){var l=new Element("div",{"class":"boolbox"});var x=new Element("div",{"class":"bool"});var t=new Element("label");t.innerHTML="true";var w=new Element("input",{type:"radio",name:"capability[boolean]",value:"true",checked:"true"});x.appendChild(t);x.appendChild(w);var D=new Element("div",{"class":"bool"});var a=new Element("label");a.innerHTML="false";var e=new Element("input",{type:"radio",name:"capability[boolean]",value:"false"});D.appendChild(a);D.appendChild(e);l.appendChild(x);l.appendChild(D);E.appendChild(l);E.appendChild(new Element("div",{"class":"clearit"}))}else{if(n=="date"){var k=new Element("div",{"class":"cleared"});var p=new Element("div");var m=new Element("div",{"class":"description"});var u=new Element("label");u.innerHTML="after date";var A=new Element("input",{type:"text",name:"capability[greater]"});p.appendChild(u);p.appendChild(A);m.innerHTML="Format: YYYY/MM";k.appendChild(p);k.appendChild(m);var b=new Element("div",{"class":"cleared"});var h=new Element("div");var o=new Element("div",{"class":"description"});var z=new Element("label");z.innerHTML="prior to date";var C=new Element("input",{type:"text",name:"capability[less]"});h.appendChild(z);h.appendChild(C);o.innerHTML="Format: YYYY/MM";b.appendChild(h);b.appendChild(o);E.appendChild(k);E.appendChild(b)}else{if(n=="number"){var g=new Element("div",{"class":"equalBox cleared"});var f=new Element("label");f.innerHTML="Is equal to ";var B=new Element("input",{type:"text",name:"capability[equal]"});if(r!=undefined&&r!=null){B.value=r}g.appendChild(f);g.appendChild(B);E.appendChild(g);var k=new Element("div",{"class":"cleared"});var p=new Element("div");var m=new Element("div",{"class":"description"});var u=new Element("label");u.innerHTML="Is greater than ";var A=new Element("input",{type:"text",name:"capability[greater]"});p.appendChild(u);p.appendChild(A);m.innerHTML="minimum: "+q.minimum;k.appendChild(p);k.appendChild(m);var b=new Element("div",{"class":"cleared"});var h=new Element("div");var o=new Element("div",{"class":"description"});var z=new Element("label");z.innerHTML="Is less than ";var C=new Element("input",{type:"text",name:"capability[less]"});h.appendChild(z);h.appendChild(C);o.innerHTML="maximum: "+q.maximum;b.appendChild(h);b.appendChild(o);E.appendChild(k);E.appendChild(b)}else{var g=new Element("div",{"class":"equalBox"});var f=new Element("label");f.innerHTML="Search String ";var B=new Element("input",{type:"text",name:"capability[like]"});if(r!=undefined&&r!=null){B.value=r}g.appendChild(f);g.appendChild(B);E.appendChild(g)}}}showCapabilityEdit({capability_name:y,group_name:j,capability_data_type:n,queryControl:E})}else{throw ("Could not find capability for "+s)}}function removeCapability(b){var a="capability-"+b;if($(a)){$(a).parentNode.removeChild($(a))}}function capabilityInCriteria(a){var f=false;var d=document.getElementsByName("capability[ids][]");for(var b=0,e=null;e=d[b];b++){if(e.value==a){f=true;break}}return f}function addCapabilityToQuery(q){try{var l=document.getElementsByName("capability[ids][]");if(l.length>4){alert("Maximum of five capabilities")}else{if(!isNaN(q.capability_id.value)){var v=$("criteriaHolder");var f=q.capability_id.value;var d=capabilitiesFull[f].name.replace(/_/g," ");if(!capabilityInCriteria(f)){var r=new Element("input",{type:"hidden",name:"capability[ids][]",value:f});v.appendChild(r);$("criteriaColumns").innerHTML+=", &quot;"+d+"&quot;"}else{var g=$$('#criteriaParams input[value="'+f+'"]');for(var s=0,p=null;p=g[s];s++){p.parentNode.parentNode.removeChild(p.parentNode)}["greater","boolean","equal","less","like"].each(function(i){var e=$$('#criteriaHolder input[name="capability['+f+"]["+i+']"]');e.each(function(j){j.parentNode.removeChild(j)})})}if(q.cape_apply_criteria.checked){var h=[];for(var s=0,n=null;n=q[s];s++){if(n.name){var w=n.name;if(w!="capability_id"&&w.match(/capability/)&&h.indexOf(w)==-1){var k=q[w];var a="";cape_name="capability["+f+"]";cape_value="";if(w.match(/boolean/)){cape_name+="[boolean]";for(var t=0,m=null;m=k[t];t++){if(m.checked){a+=" is "+m.value;cape_value=m.value}}}else{if(k.value&&k.value.length>0){cape_value=k.value;if(w.match(/greater/)){cape_name+="[greater]";a+=" is greater than "+k.value}else{if(w.match(/less/)){cape_name+="[less]";a+=" is less than "+k.value}else{if(w.match(/equal/)){cape_name+="[equal]";a+=" is equal to "+k.value}else{cape_name+="[like]";a+=" is like &quot;"+k.value+"&quot;"}}}}}h.push(w);if(a.length>0){$("criteriaWhere").show();var o=new Element("li");$("criteriaParams").appendChild(o);o.innerHTML='<span class="criteriaName">'+d+"</span> "+a+'<input type="hidden" name="critlist" value="'+f+'" />';var b=new Element("input",{type:"hidden",value:cape_value,name:cape_name});document.getElementById("criteriaHolder").appendChild(b)}}}}}hideCapabilityEdit()}}}catch(u){console.log(u.message)}return false}function searchWurfl(){var g=document.getElementsByName("capability[ids][]");if(g.length>10){alert("10 Capabilities Maximum.")}else{if(!renderedChart){showLoadingScreen();loadMessage("Processing Request");var f=Math.random();selectedCapabilities=new Object();var d="operation=search";var h=$("criteriaForm").elements;for(var a=0;c=h[a];a++){d+="&";if(c.type.toLowerCase()=="radio"){if(c.checked){d+=c.name+"="+c.value}}else{d+=c.name+"="+c.value}if(c.name=="capability[ids][]"){selectedCapabilities[c.value]=1}}try{var b=_gat._getTracker("UA-890822-5");b._trackPageview("/wurfl/device_search.html")}catch(j){if(console&&console.log){}}new Ajax.Request("./processor.php?r="+f,{method:"post",parameters:d,onSuccess:function(o){loadMessage("Building Results");var y=o.responseJSON.result;if(y!=null){hideLoadingScreen();if(y.devices.length<1){alert("The query returned no devices.")}else{renderedChart=true;$("chartGoesHere").innerHTML="";var n=["brand name","model name","user agent"];for(var r=0,m=null;m=y.columns[r];r++){if(n.indexOf(m)==-1){n.push(m)}}var k="",v="",w="",u="",l="",t="";for(var r=0,m=null;m=n[r];r++){if(r>0){k+=",";v+=",";w+=",";u+=",";l+=",";t+=","}k+=m;if(r>2){v+="right"}else{v+="left"}if(m=="brand name"){w+="80"}else{w+="*"}u+="ro";l+="str";t+="#text_filter"}buildChart(k,v,w,u,l,t);var s={rows:[]};for(var e in y.devices){var x=y.devices[e];var q={id:e,data:[]};for(var p=0,m=null;m=n[p];p++){q.data.push(x[m])}s.rows.push(q)}dchart.parse(s,"json");$("columnQuery").className="columnOneThird";new Effect.Move("slab",{x:-526})}}hideLoadingScreen()}})}}return false}function buildChart(f,g,b,d,e,a){dchart=new dhtmlXGridObject("chartGoesHere");dchart.setImagePath("js/dhtmlxgrid/imgs/");dchart.setHeader(f);dchart.attachHeader(a);dchart.setInitWidths(b);dchart.setColAlign(g);dchart.setColTypes(d);dchart.setColSorting(e);dchart.setSkin("dhx_skyblue");dchart.init();dchart.enableSmartRendering(true,"200")}function describeDevice(b){if(b!=undefined&&b!=null){if($("desc-"+b).innerHTML.length>5){$("desc-"+b).innerHTML=""}else{showLoadingScreen();loadMessage("Sending Request");var a=Math.random();new Ajax.Request("./processor.php?r="+a,{method:"post",parameters:{operation:"describeDevice",deviceId:b},onSuccess:function(h){var l=h.responseJSON.result;var f=h.responseJSON.id;loadMessage("Building Results");if(l!=null){$("desc-"+f).innerHTML="";for(var i=0;key=l.keys[i];i++){var d=l.capabilities[key];var g="stat";if(selectedCapabilities[key]!=null&&selectedCapabilities[key]!=undefined&&selectedCapabilities[key]==1){g+=" selected"}var k=new Element("div",{"class":g});var e=new Element("div",{"class":"name"});e.innerHTML=d.name;var m=new Element("div",{"class":"value"});m.innerHTML=d.value;k.appendChild(e);k.appendChild(m);k.appendChild(new Element("div",{"class":"clearit"}));$("desc-"+f).appendChild(k)}}hideLoadingScreen()}})}}return false}function output(b){if(b=="CSV"){try{var a=_gat._getTracker("UA-890822-5");a._trackPageview("/wurfl/export_"+b+".html")}catch(d){}$("output_type").value="csv";$("output_data").value=dchart.serializeToCSV();$("ext_form").submit()}return false}function getOutput(g){$("outputType").value=g;if(validateResultForm()){try{var d=_gat._getTracker("UA-890822-5");d._trackPageview("/wurfl/export_"+g+".html")}catch(f){if(console&&console.log){}}var b="";for(var a in selectedCapabilities){if(b.length>0){b+=","}b+=a+""}$("selectedCapabilities").value=b;$("results").submit()}return false}function validateResultForm(a){if($("outputType").value.length<1){alert("Internal form error, please resubmit");return false}var b=document.getElementsByName("device[]");if(b.length<1){return false}return true};